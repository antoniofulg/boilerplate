openapi: 3.1.0
info:
  title: Smart Voting MVP APIs
  version: 0.1.0
  description: >
    Contracts for the initial landing/login/dashboard experience. All schemas
    map 1:1 to the shared Zod contracts in `packages/contracts`.
servers:
  - url: https://api.smartvoto.local
    description: Development (Docker Compose / make dev)

paths:
  /auth/login:
    post:
      summary: Authenticate assessor/servidor
      description: Validates institutional credentials and issues a static session payload.
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSessionPayload'
              examples:
                success:
                  value:
                    userName: "Maria Silva"
                    role: "Secretário"
                    chamber: "Câmara Municipal de Nova Aurora"
                    issuedAt: "2025-11-22T13:00:00Z"
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many attempts (rate limited)
  /dashboard/snapshot:
    get:
      summary: Read-only dashboard snapshot
      description: Returns the static session/agenda/presence/results data used by the MVP dashboard.
      operationId: dashboardSnapshot
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Snapshot payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardSnapshot'
        '401':
          description: Session missing or expired

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: smartvoto_session
  schemas:
    AuthLoginRequest:
      type: object
      required: [emailInstitucional, senha]
      properties:
        emailInstitucional:
          type: string
          format: email
          examples: ["mesa@camara.gov.br"]
        senha:
          type: string
          minLength: 8
    AuthSessionPayload:
      type: object
      required: [userName, role, chamber, issuedAt]
      properties:
        userName: { type: string }
        role:
          type: string
          enum: ["Presidente", "Secretário", "Vereador"]
        chamber: { type: string }
        issuedAt:
          type: string
          format: date-time
    DashboardSnapshot:
      type: object
      required: [currentSession, agendaItem, memberPresence, recentResults]
      properties:
        currentSession:
          $ref: '#/components/schemas/SessionSummary'
        agendaItem:
          $ref: '#/components/schemas/AgendaItem'
        memberPresence:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/MemberPresence'
        recentResults:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/ResultLine'
    SessionSummary:
      type: object
      required: [title, status, startedAt]
      properties:
        title: { type: string }
        status:
          type: string
          enum: ["Em andamento", "Encerrada", "Agendada"]
        startedAt:
          type: string
          format: date-time
    AgendaItem:
      type: object
      required: [title, description]
      properties:
        title: { type: string }
        description:
          type: string
          maxLength: 280
        rapporteur:
          type: string
          nullable: true
    MemberPresence:
      type: object
      required: [name, isPresent]
      properties:
        name: { type: string }
        party:
          type: string
          minLength: 2
          maxLength: 5
        isPresent: { type: boolean }
    ResultLine:
      type: object
      required: [label, approved, votesYes, votesNo]
      properties:
        label: { type: string }
        approved: { type: boolean }
        votesYes:
          type: integer
          minimum: 0
        votesNo:
          type: integer
          minimum: 0
    ErrorResponse:
      type: object
      required: [message]
      properties:
        message: { type: string }
        code:
          type: string
          enum: [INVALID_CREDENTIALS, RATE_LIMITED, SESSION_REQUIRED]

